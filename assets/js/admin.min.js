var siteurl = "//" + window.location.hostname + "/" ; 
var aurl = "//" + window.location.hostname + "/api/api.php/" ; 
var ajurl = "//" + window.location.hostname  + "/" ;
 

 	
var mid;
var mremail;
var musername;
var token;
var mrole;

var decodedCookie = decodeURIComponent(document.cookie);
var ca = decodedCookie.split(';');
var _rmtoken ;

$(document).ready(function(){
	
	/*
	  
	$('.notifications, .contex-menu').remove();
    $('body').append('<div class="notifications"></div>' +
        '<div id="waitFunction">Please wait...</div>'); // wait function div
    $('.alert').hide(); 
	*/
	
	
})

	
	
for(var i = 0; i <ca.length; i++) 
    {
		var c = ca[i];
        key = ca[i].split('=')[0];  
        if(key.trim() === "_mcu")
        {
			cvalue = ca[i].substring(  6, ca[i].length   ); 
        }
		var citem = c.split('='); 
		if(citem[0].trim() == "_rmtoken")
		{
			_rmtoken = citem[1].trim();
		}
    }
 
    if(typeof cvalue   === 'undefined' )
    {
		
		
	}
    else
    {
		cvalue = $.parseJSON(cvalue);
        mid = cvalue.id;
        mremail = cvalue.email;
        musername = cvalue.name.replace('+',' ');
        token = cvalue.token; 
        mrole =  cvalue.role;
	}
	
// Wait function
function waitFunc(status) {
    if (status == 'enable') {
        $('body').css('cursor', 'wait');
        $('body > *').css('pointer-events', 'none');
        $('#waitFunction').fadeIn(500); // show please wait
    } else {
        $('body').css('cursor', 'initial');
        $('body > *').css('pointer-events', 'auto');
        $('#waitFunction').fadeOut(500); // hide please wait
    }
} 

//Show alert
function alertFunc(color, msg) {
    var alert = $('<div class="alert alert-' + color + ' animated bounce"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>' + msg + '</div>').hide();
    var timeOut;
    alert.appendTo('.notifications');
    alert.slideDown();

    //Is autoclosing alert
    var delay = 10000;
    if (delay != undefined) {
        delay = parseInt(delay);
        clearTimeout(timeOut);
        timeOut = window.setTimeout(function() {
            alert.fadeOut(200, function() {
                $(this).remove();
            });
        }, delay);
    }
    // remove last notification if more then six
    var countAlert = $(".notifications").children().length;
    if (countAlert > 6) {
        $(".notifications .alert").first().remove();
    }
} 

// Delete function
function dltFunc(text, func) {
    $('body > #confirm-box').remove(); 
    $('body').append('<div class="modal fade" id="confirm-box" >' +
        '<div class="modal-dialog modal-sm">' +
        '<div class="modal-content">' +
        '<div class="modal-body">' + text +
        '</div>' +
        '<div class="modal-footer">' +
        '<button type="button" class="btn btn-default btn-confirm" data-confirm="no">Cancel</button>' +
        '<button type="button" class="btn btn-danger btn-confirm" data-confirm="yes">Delete</button>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '</div>');

    $('#confirm-box').modal({ backdrop: 'static', keyboard: false, show: true }); // open lightbox

    $('#confirm-box .btn-confirm').click(function(e) {
        e.stopImmediatePropagation();
        var getConf = $(this).attr('data-confirm');
        if (getConf == 'yes') {
            func();
        }
        $('#confirm-box').modal('hide');
    });
}


// confirm Yes/No function
function confFunc(text, func)
{
	$('body > #confirm-box').remove(); 
    $('body').append('<div class="modal fade" id="confirm-box" >' +
        '<div class="modal-dialog modal-sm">' +
        '<div class="modal-content">' +
        '<div class="modal-body">' + text +
        '</div>' +
        '<div class="modal-footer">' +
        '<button type="button" class="btn btn-default btn-confirm" data-confirm="no">No</button>' +
        '<button type="button" class="btn btn-success btn-confirm" data-confirm="yes">Yes</button>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '</div>');

    $('#confirm-box').modal({ backdrop: 'static', keyboard: false, show: true }); // open lightbox

    $('#confirm-box .btn-confirm').click(function(e) {
        e.stopImmediatePropagation();
        var getConf = $(this).attr('data-confirm');
        if (getConf == 'yes') {
            func();
        }
        $('#confirm-box').modal('hide');
    });
}

$(document).on('click', '.btneditphone', function()
{
	var knowid = $(this).attr('data-kid'); 
	$('#knowphone' + knowid ).removeClass('hidden');  
	$(this).addClass('hidden');  
});


$(document).on('click', '.btnupdateknowphone', function()
{
	var knowid = $(this).attr('data-kid'); 
	$('#knowphone' + knowid ).addClass('hidden'); 
	$('#btneditphone' + knowid ).removeClass('hidden');
	 
	var phone = $('#tbknowphone' + knowid).val();
	  
	$.ajax({
        type: 'post',
        url: aurl + 'member/know/updatephone/',
        data: { phone: phone, knowid: knowid  },
        success: function(data)
		{
			data = $.parseJSON(data);
			waitFunc('');
			
			$('#spanknowphone' + knowid ).removeClass('hidden');  
			$('#spanknowphone' + knowid ).html(  ", <strong>Phone: </strong> " +  phone);
			alertFunc('success',   data.errmsg); 
        } 
    }); 
});

$(document).on('click', '.btneditvoc', function()
{
	event.preventDefault();
    waitFunc('enable');
	
	var knowid = $(this).attr('data-kid'); 
	var crtvocs = $('#knowvocprint' + knowid).html(); 
	var temp = new Array();
	temp = crtvocs.split(',');  
	
	  
	$('#knowvoc' + knowid ).removeClass('hidden'); 
	var i=0;
	 
	
	$.ajax({
        type: 'post',
        url: aurl + 'vocations/',
        data: { id: 0 },
        success: function(data) {
         
		 waitFunc('');
          data = $.parseJSON(data); 
            var dropdown = $('#dbvoca' + knowid );
            dropdown.empty();
            $.each( data , function(key, value)
			{ 
				if(temp.length > 0)
				{
					for(var i = 0; i < temp.length; i++)
					{
					   if(temp[i] == value.voc_name) 
					   {
						   $("#dbvoca"+knowid ).append($('<option selected ></option>').val(value.voc_name).html(value.voc_name));
					   }
					   else 
					   {
						   $("#dbvoca"+knowid ).append($('<option   ></option>').val(value.voc_name).html(value.voc_name));
					   }
					} 
				}
				else 
				{
					$("#dbvoca"+knowid ).append($('<option  ></option>').val(value.voc_name).html(value.voc_name)); 
				}
				$("#dbvoca"+knowid ).trigger("chosen:updated");	
				 
            });  
            var config = {
				'.reversevocs': {},
				'.reversevocs-deselect': { allow_single_deselect: true },
				'.reversevocs-no-single': { disable_search_threshold: 10 },
				'.reversevocs-no-results': { no_results_text: 'Oops, nothing found!' },
				'.reversevocs-width': { width: "95%" }
			}
			for (var selector in config) {
				$(selector).chosen(config[selector]);
			}  
        }
    });
	 
	$(this).addClass('hidden');  
});



$(document).on('click', '.btn_cancelvoc', function()
{
	$('.editvoc_box'  ).addClass('hidden'); 
	$('.btneditvoc').removeClass('hidden');  
});


$(document).on('click', '.btnupdatevoc', function()
{
	 
	var knowid = $(this).attr('data-kid'); 
	$('#knowvoc' + knowid ).addClass('hidden'); 
	$('#btneditvoc' + knowid ).removeClass('hidden'); 
	var vocs =   $('#dbvoca' + knowid ).chosen().val() + ''; 
	$.ajax({
        type: 'post',
        url: aurl + 'member/know/updatevocation/',
        data: { vocs: vocs, knowid: knowid  },
        success: function(data)
		{
			data = $.parseJSON(data);
			waitFunc('');  
			$('#knowvocprint' + knowid ).html(  vocs);
			alertFunc('success',   data.errmsg); 
        } 
    });
	  
});

$(document).on('click', '.btnedittag', function()
{
	var knowid = $(this).attr('data-kid'); 
	$('#knowtag' + knowid ).removeClass('hidden');  
	$(this).addClass('hidden'); 
	 
	var oldtags = $('#oldtags' +knowid ).val(); 
	if(oldtags !== null)
	{
		var tagslist  = oldtags.split(',');
	}   
	$.ajax({
        type: 'post',
        url: aurl + 'tags/',
        data: { tags:1 },
        success: function(data) {
         
          data = $.parseJSON(data);
       
            var dropdown = $('#reversetrackedittags' +knowid );
            dropdown.empty();
            $.each( data , function(key, value)
			{
				
				if(tagslist.length > 0)
				{
					for(var i = 0; i < tagslist.length; i++)
					{
					   if(tagslist[i] == value.tagname) 
					   {
						   $("#reversetrackedittags"+knowid ).append($('<option selected ></option>').val(value.tagname).html(value.tagname));
					   }
					   else 
					   {
						   $("#reversetrackedittags"+knowid ).append($('<option   ></option>').val(value.tagname).html(value.tagname));
					   }
					} 
				}
				else 
				{
					$("#reversetrackedittags"+knowid ).append($('<option  ></option>').val(value.tagname).html(value.tagname)); 
				}
				$("#reversetrackedittags"+knowid ).trigger("chosen:updated");	
				 
            });  
            var config = {
				'.reversetrackedittags': {},
				'.reversetrackedittags-deselect': { allow_single_deselect: true },
				'.reversetrackedittags-no-single': { disable_search_threshold: 10 },
				'.reversetrackedittags-no-results': { no_results_text: 'Oops, nothing found!' },
				'.reversetrackedittags-width': { width: "95%" }
			}
			for (var selector in config) {
				$(selector).chosen(config[selector]);
			}  
        }
    }); 
});

$(document).on('click', '.btnupdateknowtag', function()
{
	var knowid = $(this).attr('data-kid'); 
	$('#knowtag' + knowid ).addClass('hidden'); 
	$('#btnedittag' + knowid ).removeClass('hidden');
	 
	var tag =   $('#reversetrackedittags' +knowid ).chosen().val() + '';
	 
	$.ajax({
        type: 'post',
        url: aurl + 'member/know/updatetags/',
        data: { tag: tag, knowid: knowid  },
        success: function(data)
		{
			data = $.parseJSON(data);
			waitFunc('');  
			$('#knowtagprint' + knowid ).html(  tag);
			alertFunc('success',   data.errmsg); 
        } 
    });  
});


$(document).on('click', '.btn_cancelcz', function()
{
	$('.edit_box'  ).addClass('hidden'); 
	$('.btneditcz'  ).removeClass('hidden');
});

$(document).on('click', '.btnupdateknowcz', function()
{
	var knowid = $(this).attr('data-kid'); 
	$('#knowcityzip' + knowid ).addClass('hidden'); 
	$('#btneditcz' + knowid ).removeClass('hidden'); 
	var city =   $('#dbknowcity' + knowid).val()  ;
	var zip =   $('#tbknowzip' + knowid).val()  ;
	 
	$.ajax({
        type: 'post',
        url: aurl + 'member/know/updatecityzip/',
        data: { city: city,zip:zip,  knowid: knowid  },
        success: function(data)
		{
			data = $.parseJSON(data);
			waitFunc('');  
			$('#knowcpr' + knowid ).html(  city);
			$('#knowzpr' + knowid ).html(  zip);
			alertFunc('success',   data.errmsg); 
        } 
    });
	  
});

$(document).on('click', '.btneditcz', function()
{
	var knowid = $(this).attr('data-kid'); 
	$('#knowcityzip' + knowid ).removeClass('hidden'); 
  
	$('#dbknowcity' + knowid).html($('#reversetracklocation').html());
	$(this).addClass('hidden');  
});


$(document).on('click', '.btnvm_edit', function()
{
	var id =   $(this).attr('data-id')  ;
	var adate = $(this).attr('data-adate')  ;
	$('#vm_description').val( $(this).attr('data-desc') );
	adate = new Date( adate ); 
	 
	$('#vm_assigndate').val( (adate.getMonth() +1) + "-" +  adate.getDate()  + "-"  + adate.getFullYear() );
	
	var hour = adate.getHours();
	var hr = hour;
	if(hour > 12)
	{
		hr = hour-12; 
		$('#vm_scheduleper').val('PM');
	}
	else 
	{
		$('#vm_scheduleper').val('AM'); 
	}
	var min  = adate.getMinutes(); 
	$('#vm_schedulehr [value=hour]').attr('selected', 'true'); 
	
	$('#vm_schedulehr option').each(function(index, option)
	{
		if($(this).val() == hr) 
		{
			 $(this).attr('selected', true)
		}
	});

	$('#vm_schedulemin option').each(function(index, option)
	{
		if($(this).val() == min) 
		{
			 $(this).attr('selected', true)
		}
	});
	 
	$('input[name="vmid"]').val(  id); 

})

$(document).on('click', '.btn_assignemployee', function()
{
	var vmid =   $(this).attr('data-id')  ;
	var mid  = $(this).attr('data-mid' );  
	var name  = $(this).attr('data-name' );  
	var adate =   $('#taskdate').val()  ; ; 
	var taskdesc =   $('#taskdesc').val()  ; 
	var empid =   $('#empname').val()  ; 
	var receipent = $("#empname option:selected").text();
	 
	 
	$.ajax({
		type: 'post',
		url: aurl + 'employee/savetask/',
		data: {vmid:vmid, mid:mid, adate:  adate, name:name,  taskdesc: taskdesc, eid:empid, receipent:  receipent},
		success: function (data) 
		{
			data = $.parseJSON(data); 		 
			$('#modalsetemptask').modal('hide');  
		}
	});
}) 

$(document).on('click', '.btnvm_completed', function()
{
	var id =   $(this).attr('data-id'); 
	
	$.ajax({
		type: 'post',
		url: aurl + 'assignvoicemail/save/',
		data: {vmid:id, s:  1},
		success: function (data) 
		{
			data = $.parseJSON(data);  
			alertFunc('success', data.errmsg);
			preparevoicemailtimeline( $('#vmevent-tl').attr('data-id' ),
			$('#vmevent-tl').attr('data-name', name ) ); 
		}
	});
})

 // Edit client details
$(document).on('click', '.changeAccSett', function()
{
	$('div[data-type="changePass"]').hide();
	$('input[name="old_pass"]').val('');
	$('input[name="new_pass"]').val('');
	$('#changeAccSett').attr('data-id', $(this).attr('data-id'));
	
	waitFunc('enable');
    $.ajax({
		type: 'post',
		url: ajurl + 'includes/ajax.php',
		data: { editmemberact: $(this).attr('data-id') },
        success: function(data) {
            waitFunc('');
			var results = JSON.parse(JSON.stringify(data));
			 
			if( results.profile_missing == 1)
			{
				$('#profilemsg').html('<div class="alertmsg">User has not specified his/her profile!</div>');
			}
			else 
			{
				$('#profilemsg').html('');
			} 
            $('input[name="upd_username"]').val(results.username);
            $('input[name="upd_phone"]').val(results.user_phone);
            $('select[name="upd_country"] option[value="' + results.country + '"]').prop('selected', true);
			$('input[name="upd_street"]').val(results.street);
            $('select[name="upd_city"]').val(results.city);
            $('input[name="upd_city"]').attr('data-ov', results.city);
            $('input[name="upd_zip"]').val(results.zip); 
            $('input[name="upd_email"]').val(results.user_email);
            $('input[name="upd_public_private"][value='+results.upd_public_private+']').prop('checked', true);
            $('input[name="upd_reminder_email"][value='+results.upd_reminder_email+']').prop('checked', true);
			$('textarea[name="about_your_self"]').val(results.about_your_self);
			
			$('input[name="upd_usergrp"]').prop('checked', false);
            $('input[name="upd_uservoc"]').prop('checked', false);
            $('input[name="upd_usertarget"]').prop('checked', false);
            $('input[name="upd_usertargetreferral"]').prop('checked', false);
			
			$('input[name=busi_name_edit]').prop("disabled", false);
			$('select[name=busi_location_edit]').prop("disabled", false);
			$('select[name=busi_type_edit]').prop("disabled", false); 
			$('input[name=busi_hours_edit]').prop("disabled", false);
			$('input[name=busi_website_edit]').prop("disabled", false);  
		    $('input[name=busi_location_street_edit]').prop("disabled", false);
			
			$('select[name="membertype_edit"] option[value="' + results.user_type + '"]').prop('selected', true);
			
			$('input[name="busi_name_edit"]').val(results.busi_name);
			$('input[name="busi_location_street_edit"]').val( results.busi_location_street); 
            $('select[name="busi_location_edit"]').val( results.busi_location);
            $('select[name="busi_type_edit"]').val(results.busi_type); 
            $('input[name="busi_hours_edit"]').val(results.busi_hours);
			$('input[name="busi_website_edit"]').val(results.busi_website); 
			$('input[name="linkedin_profile"]').val(results.linkedin_profile);  
            if (results.grp.match(/,/g)) {
                var groups = results.grp.split(",");
                for (var i = 0; i < groups.length; i++) {
                    $('input[name="upd_usergrp"][value="' + groups[i] + '"]').prop('checked', true);
                }
            } else {
                $('input[name="upd_usergrp"][value="' + results.grp + '"]').prop('checked', true);
            }

            if (results.voc.match(/,/g)) {
                var voc = results.voc.split(",");
                for (var i = 0; i < voc.length; i++) {
                    $('input[name="upd_uservoc"][value="' + voc[i] + '"]').prop('checked', true);
                }
            } else {
                $('input[name="upd_uservoc"][value="' + results.voc + '"]').prop('checked', true);
            }

            if (results.target_clients.match(/,/g)) {
                var target_clients = results.target_clients.split(",");
                for (var i = 0; i < target_clients.length; i++) {
                    $('input[name="upd_usertarget"][value="' + target_clients[i] + '"]').prop('checked', true);
                }
            } else {
                $('input[name="upd_usertarget"][value="' + results.target_clients + '"]').prop('checked', true);
            }

            if (results.target_referral_partners.match(/,/g)) {
                var target_referral_partners = results.target_referral_partners.split(",");
                for (var i = 0; i < target_referral_partners.length; i++) {
                    $('input[name="upd_usertargetreferral"][value="' + target_referral_partners[i] + '"]').prop('checked', true);
                }
            } else {
                $('input[name="upd_usertargetreferral"][value="' + results.target_referral_partners + '"]').prop('checked', true);
            }
        },
        error: function() {
            waitFunc('');
            alertFunc('info', 'Something went wrong, please try again');
        }
    });
});

$(document).on('click', '.changeProfilePhoto', function () 
{
	var id = $(this).attr('data-id');  
    var path = $(this).attr('data-path');  
    $("#hidmid").val(id);
	
	user_picture = !(path) ? "images/no-photo.png" : "assets/uploads/profiles/" +     path; 
    html  = "<img src='" + user_picture + "' alt='Profile Picture' onerror='imgError(this);' class='img-rounded'  width='160'> "  ;
    
	$("#curmemphoto").html(html );  
    $('#changememberpicture').modal('show');  
})


$(document).on('click',  '.importmemberknows', function()
{
	var memberid = $(this).attr('data-user'); 
	$('#hidliuserid').val(memberid);	 
	$('#liimportmodal').modal('show');
}); 

$(document).on('click', '.linkedinimportba', function()
{
	var memberid = $('#hidliuserid').val() ; 
	 
}) 


//suggestion wizard
$(document).on('click', '.ref_wizard_byadmin', function() 
{ 
	var uid = $(this).attr('data-user');
	var role = $(this).attr('data-role');
	var refname = $(this).attr('data-refname');
	var refemail = $(this).attr('data-refemail');
	if(typeof uid != 'undefined' && typeof role != 'undefined'  && typeof refname != 'undefined' && typeof refemail != 'undefined' )
	{
		$('.refereruid').val(uid  );
		$('.referername').val(  refname );
		$('.refererrole').val(  role );
		$('.refereremail').val(  refemail );
	} 
	
	var sourceoptions = 
	{
		url: function(phrase)
		{
			return "includes/autocomplete-member-byadmin.php?phrase=" + phrase + "&format=json" + "&uid=" +  uid + "&role=" +  role ;
        },
        getValue: "name", 
        list: 
		{
			onSelectItemEvent: function() 
			{
                var value = $("#leftmemberremote").getSelectedItemData();
                $('#lmid').val(value.code); 
            }
        } 
    };
	
	$("#leftmemberremote").easyAutocomplete(sourceoptions); 
    
	var options =
	{
		url: function(phrase)
		{
			return siteurl + "my-network/autocomplete_name?phrase=" + phrase + "&format=json";
        },
        getValue: "name", 
        list:
		{
			onSelectItemEvent: function()
			{
				var value = $("#provider-remote").getSelectedItemData();
                $('#rmid').val(value.code); 
            }
        } 
    }; 
    $("#provider-remote").easyAutocomplete(options); 
    $('#suggestwizard').modal('show'); 
	$('#onetooneintroduction').modal('hide');  
});
 
//Delete user
$(document).on('click', '.delUser', function() {
    var userID = $(this).attr('data-user');

    confFunc('This action is irreversible and will delete all data related to this user.<br/><br/> Are you sure you want to DELETE this user?', function() { 
	
		var form = $('<form action="' + window.location.href + '" method="post">' +
        '<input type="hidden" name="userid" value="' + userID + '" />' +
		'<input type="hidden" name="btn_delmember" value="rem" />' +
        '</form>');
		$('body').append(form);
		form.submit();  
    });
});
$(document).on('click', '.delclques', function()
{
	var quesid = $(this).attr('data-i'); 
	confFunc('This action is irreversible and will delete the question assigned to client. <br/><br/> Are you sure you want to DELETE the selected question?', function() 
	{
        var form = $('<form action="' + window.location.href + '" method="post">' +
        '<input type="hidden" name="quesid" value="' + quesid + '" />' +
		'<input type="hidden" name="btn_delquestion" value="rem" />' +
        '</form>');
		$('body').append(form);
		form.submit();  
    });
	
})

// Update/Edit Vocations ********
$(document).on('change', '.fetVocations', function() {
    var currVoc = $('.fetVocations option:selected').text();
	var currVocID = $('.fetVocations option:selected').val();
    var currVocVal = $(this).val();
    if (currVocVal == 'null') {
        $('.editVocation').val('');
        return;
    }
	
	
	$('#hid_voc_id').val(currVocID);
    $('.editVocation').val(currVoc).attr('data-val', currVocVal);
}); 
 

 
$(document).on('change', '.fetchLifestyles', function()
{
	var currLifestyle = $('.fetchLifestyles option:selected').text();
	var currLSID = $('.fetchLifestyles option:selected').val();
    var currLifestyleVal = $(this).val();
    if (currLifestyleVal == 'null') {
        $('.editLifestyle').val('');
        return;
    }
	$('#hid_ls_id').val(currLSID);
    $('.editLifestyle').val(currLifestyle).attr('data-val', currLifestyleVal);

});


$(document).on('click', '.edithelpvideo', function() {

    var helpid = $(this).data('id');
    $.ajax({
        type: 'post',
        url: 'includes/ajax.php',
        data: { gethelpvideo: 1, id: helpid },
        success: function(data) {
            record = JSON.parse(data);
            $('#btnsavehelp').attr('data-id', record[0].id);
            $('#helptitle').val(record[0].helptitle);
            $('#helpvideo').val(record[0].helpvideo);
        }
    });
})

$(document).on('click', '.btnsavesortingorder', function () 
{
	var tstrows = $('#divtestimonials > tr');
	var ids = [];
	
	$('#divtestimonials > tr').each(function(i) 
	{
		ids.push( $(this).attr('data-id') ) ; 
    });
	
	if(ids.length > 0)
	{
		var form = $('<form action="' + window.location.href + '" method="post">' +
        '<input type="hidden" name="tm_ids" value="' + ids.join(",")  + '" />' +
		'<input type="hidden" name="save_sorting" value="save" />' +
        '</form>');
		$('body').append(form);
		form.submit();  
	}   
})  
$(document).on('click', '.deletestimonial', function() {

    var testimonialid = $(this).attr('data-id'); 
    confFunc('This action is irreversible and will delete all data related to this testimonial.<br/><br/> Are you sure you want to DELETE this testimonial?', function() {
        waitFunc('enable');
        var form = $('<form action="' + window.location.href + '" method="post">' +
        '<input type="hidden" name="del_id" value="' + testimonialid  + '" />' +
		'<input type="hidden" name="del_tmv" value="delete" />' +
        '</form>');
		$('body').append(form);
		form.submit();
    });
});  
$(document).on('change', '.fetchTag', function() {
    var currTag = $('.fetchTag option:selected').text(); 
    var currTagVal = $(this).val();
    if (currTagVal == 'null') {
        $('.editTag').val('');
        return;
    }
	$('#hid_tag_id').val(currTagVal); 
    $('.editTag').val(currTag).attr('data-val', currTagVal); 
});

$(document).on('change', '.userClientGrps', function() {
    var currGrp = $('.userClientGrps option:selected').text();
    var currGrpVal = $(this).val();
    if (currGrpVal == 'null') {
        $('.newGrpVal').val('');
        return;
    }
	$('#hid_grp_id').val(currGrpVal); 
    $('.newGrpVal').val(currGrp).attr('data-val', currGrpVal);
});
$(function() {
    $("#helptable").sortable({
        update: function() {
            $.each($("#helptable .ui-sortable-handle:not(.ui-sortable-placeholder)"), function(key, val) {

                position = key;
                id = $(val).data('id');
                $.ajax({
                    type: 'post',
                    url: 'includes/ajax.php',
                    data: { updfaqpos: '1', position: position, id: id }
                });


            });
        }
    });
    $("#helptable").disableSelection();
});



$(document).on('click', '.vuconnections', function()
{
	var uid = $(this).attr('data-uid');
	var partnerid = $(this).attr('data-pid');
	
	 $('.ccviewtable').html("<div class='text-center'><img   src='../assets/images/processing.gif' alt='Loading ...' /></div>");
	 
	 $.ajax({
        type: 'post',
        url: aurl + 'members/commonconnects/getall/',
        data: { uid: uid, partnerid: partnerid},
        success: function(data)
        { 
            data = $.parseJSON(data);    
            if(data.error == 1 )
            { 
				 $('.ccviewtable').html("");
                alertFunc('danger',  'Something went wrong, please try again');
            } 
			if(data.error == 10 )
            { 
				 $('.ccviewtable').html("");
                alertFunc('danger',  data.errmsg);
            } 
            else 
            {
                var html = "<table class='table table-sm'>";
                html += "<tr id='$rand-$id'>" +
                "<th>Connection Name</th>" +
                "<th>Email</th>"   + "<th>Phone</th>"  +
				"<th>Profession</th>" +  "</tr> " ;
    
                $.each(data.results, function (index, item) 
                {
                    client_name = item.client_name ;
                    client_profession = item.client_profession ;
                    client_email = item.client_email ;
					client_phone = item.client_phone ;
                   
                    html += "<tr id='$rand-$id'>" +
                        "<td>"  + client_name  + "</td>" +
                         "<td>"  + client_email  + "</td>" +
                        "<td  >"  +client_phone   +  "</td><td>" + 
						  client_profession +
						"</td>" + 
                        "</tr> " ;
                });
				 
                html += "</table>"; 
                $('.ccviewtable').html( html );  
            } 
        }  
    });  
}); 

$(document).on('click', '.btncontactsignup', function()
{
	var id = $(this).attr('data-id');
    var email = $(this).attr('data-email');  
    $('.sendemailforunifinishsignup').attr('data-id', id);
    $('.sendemailforunifinishsignup').attr('data-email', email);
    $('#emailunifinishsignup').modal('show'); 
}) 




$(document).on('click', '.btncomposeinvite', function() {
    var knowid = $(this).attr('data-id');
 
    var form = $('<form action="' + window.location.href + '" method="post">' +
        '<input type="hidden" name="knowid" value="' + knowid + '" />' +
		'<input type="hidden" name="hid_invite" value="send" ></button>' + 
		'<button type="submit" name="btn_invite" value="send" ></button>' + 
        '</form>');
		$('body').append(form);
	form.submit();  
});

 

$(document).on('change', '#memberid', function () 
{
	var id = $('#memberid').val();
	$('#partnerid').val(  id ) ;
	$('#partnername').val( $('#memberid :selected').text() ) ;
	
	if(id > 0)
	{
		var options = 
		{
			url: function(phrase) 
			{
				return siteurl + "invite-knows/autocomplete_know_names?phrase=" + phrase + "&mid=" + id  + "&format=json";
			},
			getValue: "name", 
			list: {
				onSelectItemEvent: function() {
					var value = $("#provider-remote-know").getSelectedItemData();
					$('#knowid').val(value.code); 
				}
			} 
		}; 
		  
		$("#provider-remote-know").easyAutocomplete(options); 
	} 
	
})




$(document).on('click', '.btn_connect_invite', function() 
{
	var id = $(this).attr('data-id');    
	 
	$.ajax({
        type: 'post',
        url: aurl + 'member/know/invitetojoin/',
        data: { id: id , mid: mid},
        success: function(data) 
		{
			data = $.parseJSON(data); 
			alertFunc('info',  data.errmsg)			
        } 
	});
});

$(document).on('click', '.btnrequestcity', function() 
{
	var receipentname = $('#provider-remote-know').val();
	var knowid = $('#knowid').val();
	var partner = $('#partnerid').val();
	
	waitFunc('enable');
    $.ajax({
        type: 'post',
        url: aurl + 'mailtemplates/rated6/',
        data: { 
            templateid: 2 ,  
            receipentname: receipentname,
            knowid: knowid,  
			partnerid: partner
			 
         },
        success: function(data)
		{
			waitFunc(''); 
			data = $.parseJSON(data);    
			
			if(data.error == 1)
            {
                 alertFunc('danger', 'Email preview generation failed. Please retry again!'); 
            }
            else 
            { 
				$('#rated6_mailbody').html(data.templatebody);  
				if(CKEDITOR.instances.rated6_wiz_emailbody)
				{
					CKEDITOR.instances.rated6_wiz_emailbody.destroy(); 
				}
				CKEDITOR.replace( 'rated6_wiz_emailbody' ); 
				CKEDITOR.instances.rated6_wiz_emailbody.setData( $('#rated6_mailbody').html() );
				 
				$('.wiz_rated6_send_referral_mail').attr('data-receipent', receipentname);
				$('.wiz_rated6_send_referral_mail').attr('data-knid', knowid);
				$('.wiz_rated6_send_referral_mail').attr('data-id', partner); 
				  
				$("#rated6_intromail").modal('show'); 
            } 	 
        },
		error: function(data)
		{
			 waitFunc(''); 
		}
    });
}) 

$(document).on('click', '.wiz_rated6_send_referral_mail', function()
{ 
	var email = "";
	var receipent = $(this).data('receipent');
	var knid = $(this).data('knid');
	var partner = $(this).data('id');
	var emailbody = CKEDITOR.instances.rated6_wiz_emailbody.getData();  
	waitFunc('enable');
    $.ajax({
        type: 'post',
        url: aurl + '/email/rated6invite/',
        data: 
        {
            templateid: 1,
            receipent: receipent,
            email: email, 
			emailbody:emailbody,
			knowid: knid,
			partner:partner
        },
        success: function(data) 
		{  
		   alertFunc('success', 'Your introduction mail has been sent!');
		   waitFunc('');
           $("#rated6_intromail").modal('hide'); 
        },
		error: function() {
         waitFunc('');
			$("#rated6_intromail").modal('hide'); 
		} 
    }); 
})

