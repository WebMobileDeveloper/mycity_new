$(document).on('click', '.loadmyclients', function() 
{
	var page = $(this).attr('data-pg'); 
	if(typeof page == 'undefined' || page =='')
	{
		page =1;
	}
	showmembers(page ); 
})


$(document).on('click', '.searchassignclient', function() 
{
	var cname = $('#tbassignclient').val();
	showmembers( 1, cname ); 
})


function showmembers(page1, client='')
{
	$.ajax({
		type: 'post',
		url: aurl + 'member/getassignedclient/', 
		data: { page1:page1 , mid:mid,  client:client  },
		success: function (data) 
		{
			data = $.parseJSON(data); 
			html = "<table class='table table-responsive'>";
			html += "<tr ><th></th><th>Name</th><th>Email</th> <th>Select</th> </tr>"  ;  
			$.each(data.results, function (index, item) 
			{
				user_picture = !( item.image ) ?  "images/no-photo.png" :  "images/"  +  item.image;   
				html += "<tr id='row" + index + "'>" + 
				"<td  ><img src='"  + user_picture  +  "' alt='"  +  item.username   + "'  onerror='imgError(this);' class='img-rounded' height='55' width='55'></td>" +
				"<td>" + item.username + "</td>" +
				"<td>" + item.user_email + "</td>" +  
				"<td><input type='radio' name='rad_member' value='" +  item.a  + "'></td>" +  
				" </tr>";   
				
			});
			 
			var pages = data.page1;
			var prev =  page1 == 1 ? 1 :  parseInt(page1) -1;
			var next =  page1 ==  pages ?  pages :  parseInt(page1) + 1; 
			html  += "<tr><td colspan='5'><ul class='pagination actmempage'><li><a data-func='prev' data-pg1='" + prev + "'  data-client='" + client + "'>«</a></li>";
			for( i=1;  i <= pages;  i++)
			{
				active =  i ==  page1 ? 'active' : '';
				html += "<li class='" + active + "'><a data-pg1='" + i + "'   data-client='" + client + "'>" + i + "</a></li>";
			} 
			html += "<li><a data-func='next' data-pg1='" + next +  "'  data-client='" + client + "'>»</a></li></ul></td></tr>";
			html += "</table>";	 	
			$('#memselecgrid').html(html);   
		}
	});  
}


$(document).on('click', '.chooseprogparticipants', function() 
{
	var page = $(this).attr('data-page' );
	if(typeof page ==='undefined' || page =='')
	{
		page = 1;
	}
	$('.tl-box').hide();
	
	var page = $(this).attr('data-pg'); 
	if(typeof page == 'undefined' || page =='')
	{
		page =1;
	} 
	reloadallactmembers( page,mid ); 
}) 

$(document).on('click', '#btn_src3trelation', function() 
{
	var rname = $('#tb_3trelation').val();
	var tags = $('#3tsearchtag').chosen().val() + '';
	reloadallactmembers(1, mid, rname , tags); 
})



function reloadallactmembers(page, ppid = 0,  client='', tags=''  )
{
	html ='';
	$.ajax({
		type: 'post',
		url: aurl + 'program/member/performance/',
		data: {page: 1, program: 1, mid: ppid },
		success: function (data) 
		{
			data = $.parseJSON(data); 
			if(data.results[0].relations != 'na')
			{
				html ='<h4>Relations Added in your 3 Touch Program</h4>';
				$.each(data.results[0].relations, function(k, relitem)
				{
					html += "<span class='nlink track3tprogress' data-prog='1' data-id='" + relitem.a + "' data-name='" + relitem.b + "' >" + relitem.b + "</span> "  ;  
				})
			}
			else
			{
				html += "You have not added relation under your 3 touch program!";
			}  
			html +='<hr/>';
			$('#pprelations').html(html);  
		}
	}); 
	
	$.ajax({
		type: 'post',
		url: aurl + 'member/getallknows/', 
		data: { userid: ppid, page:page, client:client, tags:tags   },
		success: function (data) 
		{
			data = $.parseJSON(data);
			 
			html = "<table class='table table-responsive'>";
			html += "<tr > <th>Name</th><th>Vocation</th> <th>Select</th><th>Action</th></tr>"  ;  
			$.each(data.results, function (index, item) 
			{
				html += "<tr id='row" + index + "'>" + 
				 "<td>" + item.b + "</td>" +
				"<td>" + item.c + "</td>" +  
				"<td><input type='checkbox'  name='cb_relatedmembers' value='" +  item.a  + "'> </td>" + 
				"<td>";
				html += "<div class='dropdown '><a  href='#' class='dropdown-toggle btn btn-primary' data-toggle='dropdown' role='button' aria-haspopup='true' aria-expanded='false' ><i class='fa fa-cog'></i> </a>" +
				"<ul class='dropdown-menu pull-right'> " +
				 "<li><a href='#' data-toggle='tab' class='track3tprogress' data-prog='1' data-id='" + item.a + "' data-name='" + item.b + "'   >Track Progress</a></li>" +
				"</ul> " ;
				html +=  "</div></td></tr>";
				
			});
			
			if(data.page > 0)
			{			
				html  += "<tr><td colspan='3' class='text-right'> " +
				"<input type='button' class='btn btn-success btn3taddrelationship'  value='Add as 3 Touch Relationship'  >" + 
				"</td><td ></td></tr>";
			} 
			var pages = data.page;
			var prev =  page == 1 ? 1 :  parseInt(page) -1;
			var next =  page ==  pages ?  pages :  parseInt(page) + 1;  
			html  += "<tr><td colspan='5'><ul class='pagination 3tpagers'>" +
		    "<li><a  data-func='first' title='First Page' data-pg='1' data-client='" +  client + "' data-tag='" + tags + "'  >First Page</a></li> " +
			"<li><a data-func='prev' data-pg='" + prev + "'  data-client='" +  client + "' data-tag='" + tags + "'  >«</a></li>";
			
			if( page > 10)
				html += "<li><a  data-func='next' title='Show last few pages' data-pg='1' data-client='" +  client + "' data-tag='" + tags + "' > ... </a></li>";
			if( page < 10) 
			{
				for(var j = 1 ; j  <=  10  ; j++)
				 {
					 if(j > pages)
					 {
						 break;
					 }
					 active =  j ==  page ? 'active' : ''; 
					 html += "<li class='" + active + "'><a  data-pg='" + j  + "' data-client='" +  client + "' data-tag='" + tags + "' >" + j  + "</a></li>";
				 } 
			}
			else 
			{ 
				for( var i = parseInt(page) - 5;  i <=   parseInt(page) + 5  ;  i++ )
				{
					
					if( i > pages)
					{
						 break;
					}
					active  =  i ==  page ? 'active' : '';
					html +=   "<li class='" + active + "'><a data-pg='" + i  + "' data-client='" +  client + "' data-tag='" + tags + "'  >" + i  + "</a></li>";
				 }
			}
			
			if( parseInt(page)  < ( pages - 10 ) )
			{
				html +=  "<li><a  data-client='" +  client + "' data-tag='" + tags + "'  data-func='next' title='Show last few pages' data-pg='" + pages + "'> ... </a></li>"; 
			}
			
			html += "<li> <input class= 'form-control tbgotopage'  type='text' style='width: 120px; height: 32px; margin-top: 2px; margin-right: 5px; float: left; display: inline-block;' placeholder= 'Go to page ...' > </li>";
			html += "<li> <input class='btn gotopage' type='button'  value='Go' style='width: 50px; float: left; height: 32px; margin-top: 2px; display: inline-block;  background-color: #2e353d; color: #fff;'   > </li>";
			html += "<li><a  data-func='next' title='Next Page' data-client='" +  client + "' data-tag='" + tags + "'  data-pg='" + next +  "'>»</a></li> "; 
			html += "<li><a  data-func='last' title='Last Page' data-client='" +  client + "' data-tag='" + tags + "'  data-pg='" + pages +  "'>Last Page</a></li> ";
		  
			html += "</ul></td></tr>";
			html += "</table>";
			$('#progparticipantgrid').html(html);  
		}
	});  
}

$(document).on('click', '.3tpagers li a', function () 
{
	var page = $(this).attr('data-pg'); 
	var em_client = $(this).attr('data-client'); 
	var em_tag = $(this).attr('data-tag'); 
	
	reloadallactmembers(page, mid,  em_client, em_tag); 
})


$(document).on('click', '.3tpagers .gotopage', function()
{
	var pageno = $('.3tpagers .tbgotopage').val( );
	var em_client = $(this).attr('data-client'); 
    var em_tag = $(this).attr('data-tag'); 
    if (pageno <= 0) pagesize = 1; 
    var em_client = $(this).attr('data-client'); 
	reloadallactmembers(pageno, mid, em_client,em_tag);
	 
}); 

$(document).on('click', '.btn3taddrelationship', function () 
{
	  
	var relatelist = [];
	$('input[name=cb_relatedmembers]').each(function()
	{
		if(this.checked )
			relatelist.push( $(this).val() ); 
	});
	 
	if(relatelist.length > 0)
	{
		 
		$.ajax({
			type: 'post',
				url: aurl + 'program/participant/addtracking/',
				data: { ids : relatelist.join(","), mid:mid, pid: 1},
				success: function(data) 
				{
					if (data == 'user_error') 
					{
						alertFunc('danger', 'Something went wrong, please try again');
					}
					else 
					{
						alertFunc('success', '3 Touch Program Relationships are saved!'); 
					}
					waitFunc(''); 
					reloadallactmembers( 1, mid ); 
				} 
		});  
	} 
})



function chooseallparticipants(page, program)
{
	
	
	$('#progparticipantgrid').html();  
	$.ajax({
		
		type: 'post',
		url: aurl + 'members/getprofiles/',
		data: {page: page, program: program, mid: mid },
		success: function (data) 
		{
			data = $.parseJSON(data); 
			 
			html = "<table class='table table-responsive'>";
			html += "<tr ><th></th><th>Name</th> <th>Action</th></tr>"  ;  
			$.each(data.results, function (index, item) 
			{
				if(mid != item.c)
				{
					
				user_picture = !( item.h ) ?  "images/no-photo.png" :  "images/"  +  item.h;   
				html += "<tr id='row" + index + "'>" + 
				"<td><img src='"  + user_picture  +  "' alt='"  +  item.un   + "'  onerror='imgError(this);' class='img-rounded' height='55' width='55'></td>" +
				"<td>" + item.un + "</td>" ; 
				  
				html += "<td><div class='dropdown pull-right'><a  href='#' class='dropdown-toggle btn btn-primary' data-toggle='dropdown' role='button' aria-haspopup='true' aria-expanded='false' ><i class='fa fa-cog'></i> </a>" +
				"<ul class='dropdown-menu'> " +
				"<li><a href='#' data-toggle='tab' class='addtotracking' data-prog='"+  item.p + "' data-id='" + item.c + "' data-name='" + item.un + "'   >Add to tracking list</a></li>" +
				"<li><a href='#' data-toggle='tab' class='track3tprogress' data-prog='"+  item.p + "' data-id='" + item.c + "' data-name='" + item.un + "'   >Track Progress</a></li>" +
				
				"</ul> " ;
				html +=  "</div></td></tr>";
				
				}
			});
			var pages = data.page ;
			if(pages > 1)
			{
				var prev =  page == 1 ? 1 :  parseInt(page) -1;
				var next =  page ==  pages ?  pages :  parseInt(page) + 1; 
				html  += "<tr><td colspan='5'><ul class='pagination progmems'><li><a data-func='prev'   data-pg='" + prev + "'  >«</a></li>";
				for( i=1;  i <= pages;  i++)
				{
					active =  i ==  page ? 'active' : '';
					html += "<li class='" + active + "'><a  data-pg='" + i + "' >" + i + "</a></li>";
				} 
				html += "<li><a data-func='next'  data-pg='" + next +  "'  >»</a></li></ul></td></tr>"; 	 
			} 
			html += "</table>";	
			$('#progparticipantgrid').html(html);  
		}
	}); 
} 


$(document).on('click', '.addtotracking', function() 
{
	var idtotrack = $(this).attr('data-id');
	$.ajax({
		type: 'post',
		url: aurl + 'program/participant/addtracking/',
		data:  { idtotrack:idtotrack, id: mid, pid: 1 } , 
		success: function(data) 
		{
			data = $.parseJSON(data);
			alertFunc('success', data.errmsg);      
		}
	});
})


$(document).on('click', '.track3tprogress', function() 
{
	var pid = $(this).attr('data-prog');
	var cid = $(this).attr('data-id'); 
	var name = $(this).attr('data-name');
	reloadtrack3tprogress(pid, cid, name); 
})


function reloadtrack3tprogress(pid, cid, name)
{
	$('.btnadd3tq').attr('data-id', cid);
	$('.btnadd3tq').attr('data-name', name);
	$('.btndel3tq').attr('data-id', cid);
	$('.btndel3tq').attr('data-name', name);
	
	 
	$.ajax({
		type: 'post',
		url: aurl + 'program/participant/checkrelation/',
		data:  { idtotrack:cid, mid: mid, pid: 1 } , 
		success: function(data) 
		{
			data = $.parseJSON(data);  
			if(data.allow ==0)
			{
				alertFunc('success', "Selected participant has not been added in your watched list.");  
				$('.tl-box').hide();
				$('#program-tl').empty();
				$('#programprogress').html('');				
			}
			else 
			{
				alertFunc('success', "Selected participant's program progress fetched. Scroll down to see report.");    
				prepareprogress(pid, cid, name);
			}
		} 
	}); 
}



function prepareprogress(pid, cid, name)
{
	$('#programprogress').html("<div ><img   src='../images/processing.gif' alt='Loading ...' width='160px' /></div>");
	$('.tl-box').hide();
	$('#program-tl').empty(); 
	$.ajax({
		type: 'post',
		url: aurl + 'program/participant/getassignedquestions/',
		data: {  pid : pid , mid:mid, relid:cid},
		success: function (data) 
		{
			data = $.parseJSON(data); 
			if(data.count > 0)
			{ 
				$.each(data.results, function(index, item)
				{
					if( item.a == ""|| item.a == null )
					{
						nulitem = "<li ><span></span>" ; 
						answer  = "<br/><strong>ANSWER: </strong> ";  
						answer += "<textarea  style='resize: vertical !important;' id='ans" + item.i + "' class='form-control'></textarea>";
					}
					else 
					{
						answer  = "";
						nulitem = "<li class='processed'><span></span>" ;
						answer  = "<br/><strong>ANSWER: </strong>"  ; 
						answer += "<textarea  style='resize: vertical !important;' id='ans" + item.i + "'  class='form-control'>" + item.a + "</textarea>"; 
					}
					buttons  = "<hr/><button data-qno='" +  item.qno + "' data-desc='" +  item.a + "'  data-id='" +  item.i + "' class='btn btn-primary btn-xs btnsv3tans'>Save Answer</button>" ;
					nulitem += "<div class='title'>Question #" + (index +1) + "</div>" + 
					"<div class='info'>"+ item.q ;
					nulitem += answer ;
					nulitem += (  item.af  == 'null' || item.af  == '' || item.af  ==  null   ? '' : item.af );
					nulitem +=  buttons + " </div> </li>" ;
					$('#program-tl').append(nulitem);  
				}) 
				
				$('#program-tl').attr('data-seq', data.count); 
			} 
			else 
			{
				var d = new Date();
				var curr_date = d.getDate();
				var curr_month = d.getMonth() + 1;  
				var curr_year = d.getFullYear();
				nulitem = "<li><span></span>" +
				"<div class='title'>Question #0</div>" +
				"<div class='info'>No Question Added Yet</div>" + 
				"</li>" ; 
			    $('#program-tl').append(nulitem);
				$('#program-tl').attr('data-seq', 0); 				
			}  
			$('.tl-box').show(); 
			$('#3tp_progress').html(" for " + name );
			$('#programprogress').html("");
		}
	});	 
}


$(document).on('click', '.btnsv3tans', function() 
{
	var quesid = $(this).attr('data-id');
	var ans = $('#ans' + quesid).val();
	
	var qno = $(this).attr('data-qno');
	var add_ans = {};
	var ans_json='';
	if(qno == 3)
	{
		//read checkboxes 
		$("input[name='meet_state']").each( function () 
		{  
			if($(this).prop('checked') == true)
			{
				add_ans[  $(this).attr('data-field')   ] =  $(this).val()  ; 
            } 
		}); 
	}
	else  if(qno == 4)
	{
		//read checkboxes 
		$("input[name='follow_up']").each( function () 
		{
			if($(this).prop('checked') == true)
			{
				add_ans[  $(this).attr('data-field')   ] =  $(this).val()  ; 
            } 
		});
		$("input[name='follow_result']").each( function () 
		{  
			if($(this).prop('checked') == true)
			{
				add_ans[  $(this).attr('data-field')   ] =  $(this).val()  ; 
            } 
		}); 
	}  
	
	ans_json = JSON.stringify(add_ans);
	
	$.ajax({
		type: 'post',
		url: aurl + 'program/participant/answer/save/',
		data:  { quesid:quesid, ans: ans, add_ans:ans_json } , 
		success: function(data) 
		{
			data = $.parseJSON(data);  
			alertFunc('success', data.errmsg);      
		} 
	});
});	

$(document).on('click', '.btnadd3tq', function() 
{
	var pid = '1';
	var relid = $(this).attr('data-id');
	var mname = $(this).attr('data-name');
	
	$('.up3tquestions').attr('data-relid', relid);
	$('.up3tquestions').attr('data-name', mname);
	 
	
	laodprogramquestions( pid, relid, '3tqa' )
	$('#modal3tquestion').modal('show');
});	 
$(document).on('click', '.btndel3tq', function() 
{
	var pid = '1';
	var id = $(this).attr('data-id');
	var mname = $(this).attr('data-name');
	 
	var relatelist = [];
	relatelist.push(  id  ); 
	
	confFunc('Are you sure you want to delete ' +  mname + '?', function() {
        waitFunc('enable');
        $.ajax({
            type: 'post',
            url: aurl + 'program/participant/removetracking/',
           data: { ids : relatelist.join(","), mid:mid, pid: 1},
            success: function(data) 
			{
                waitFunc('');
				alertFunc('success', 'Relation removed successfully');
				//hide timeline
				reloadallactmembers( 1, mid );
$('.tl-box').hide();
				$('#program-tl').empty();
				$('#programprogress').html('');				
            } 
        });
    }) 
});	 

function laodprogramquestions( pid, relid , target)
{
	$.ajax({
		type: 'post',
		url: aurl + 'program/participant/getquestions/',
		data: {pid: pid, mid: relid },
		success: function (data) 
		{
			data = $.parseJSON(data);  
		 
			html =  "<table class='table table-responsive table-bordered'>";
			html += "<tr ><th>Select</th><th>Question</th> </tr>"  ;  
			$.each(data.results, function (index, item) 
			{
				if(item.asg == 1)
				{
					var selected ="checked";
				}
				else
				{
					var selected ="";
				}
				html += "<tr id='row" + index + "'>" + 
				"<td>" + 
				"<input "  +   selected +    " type='checkbox' class='cbpqid' data-qid='" +  item.i + "' /> " + "</td>" +
				"<td>" + item.q + "</td>"   ; 
				html +=  " </tr>"; 
			}); 
			html += "</table>";
			html +="<strong>Selected questions will be asked to the participant. If you want to remove a question from asking to the selected participant, simply deselect the question.</strong>" ;
			$('#' + target).html(html);   
		}
	}); 
} 

$(document).on('click', '.up3tquestions', function()
{ 
	var relid = $(this).attr('data-relid'); 
	var name = $(this).attr('data-name');
	var pid  =  1;
	
	var myObj = {};
	var i=0;
	$(".cbpqid").each(function()
	{
		myObj["q_" + i] =  $(this).attr('data-qid');  
		if($(this).is(':checked'))
		{
			myObj["act_" + i] = "1";  
		}
		else
		{
			myObj["act_" + i] = "0";  
		}		
		i++;
	})
	myObj["totalq"] = i ;
	myObj["pid"] = pid;
	myObj["mid"] =  mid; 
    myObj["relid"] =  relid;
	var json = JSON.stringify(myObj);
	 
	$.ajax({
		type: 'post',
		url: aurl + 'member/program/questions/assign/',
		data:  json ,
		contentType: "application/json",
		success: function(data) 
		{
			data = $.parseJSON(data);  
			waitFunc(''); 
			alertFunc('success', data.errmsg);   
			
			//reload questions 
			
			reloadtrack3tprogress(pid, relid, name);
		} 
	}); 
})


$(document).on('click', '.mn_privacysetting', function()
{
	
})

$(document).on('click', '.updateprivacy', function()
{
	var privacyset = $("#whocanview").val(); 
	
	$.ajax({
		type: 'post',
		url: aurl + 'member/privacy/update/',
		data: { privacyset : privacyset, mid: mid }, 
		success: function(data) 
		{
			data = $.parseJSON(data);  
			waitFunc(''); 
			alertFunc('success', data.errmsg);
			 
		}
	}); 
	
})
 
$(document).on('click', '.3tactivitylogs', function()
{
	previewactivitylog( 1 , mid );
	
	 
})


function previewactivitylog(pid, ppid )
{ 
	$('#3t_activities_log').html("<div ><img   src='../images/processing.gif' alt='Loading ...' width='160px' /></div>");
	 
	 
	var html ='';
	$.ajax({
		type: 'post',
		url: aurl + 'member/program/activity/log/',
		data: { pid : pid , mid: ppid }, 
		success: function (data) 
		{
			data = $.parseJSON(data);
			$('#3t_activities_log').html(""); 
			$("div#3t_activities_log").append("<div class='tl-box'></div>"); 
			$("div#3t_activities_log .tl-box").append("<ul class='program-tl'></ul>");			
			
			if(data.count > 0)
			{
				$.each(data.result, function(index, item)
				{ 
					nulitem = "<li ><span></span>" ;
					buttons  = "<br/><hr/><a data-toggle='tab'  href='#menu75' data-id='" +  item.d + "'  data-name='" +  item.e + "' data-prog='" +  pid + "' class='btn btn-primary btn-xs gotrack3tprogress'>View</a>" ; 
					
					nulitem += "<div class='title'>Relation Name: " + item.e + "</div>" +  
					"<div class='info'>"+ item.a ;
					nulitem +=   buttons + "</div>" + 
                    "<div class='time' >" +
					"<span>" + item.c + "</span>" + 
                    "</div>" +
					" </li>" ; 
					$("div#3t_activities_log .tl-box .program-tl").append(nulitem);  
					 
				}) 
				  
			} 
			else 
			{
				var d = new Date();
				var curr_date = d.getDate();
				var curr_month = d.getMonth() + 1;  
				var curr_year = d.getFullYear();
				nulitem = "<li><span></span>" +
				"<div class='title'>Question #0</div>" +
				"<div class='info'>No Question Added Yet</div>" + 
				"</li>" ;
				
			    $('#program-tl').append(nulitem);
				$('#program-tl').attr('data-seq', 0); 				
			}  
			$('.tl-box').show(); 
			  
		}
	});	 
}

$(document).on('click', '.gotrack3tprogress', function() 
{
	var page = $(this).attr('data-page' );
	if(typeof page ==='undefined' || page =='')
	{
		page = 1;
	}
	$('.tl-box').hide();
	
	var page = $(this).attr('data-pg'); 
	if(typeof page == 'undefined' || page =='')
	{
		page =1;
	}
	reloadallactmembers( page,mid ); 
	
	var pid = $(this).attr('data-prog');
	var cid = $(this).attr('data-id'); 
	var name = $(this).attr('data-name');
	reloadtrack3tprogress(pid, cid, name); 
})


$(document).on('click', '.src_all_knows', function() 
{
	 
	var src_name = $('#src_name').val(); 
	var src_vocation = $('#src_vocation').chosen().val() + ''; 
	searchallknows(1, src_name,   src_vocation); 
}); 

function searchallknows( page, src_name,   src_vocation)
{ 
	$.ajax({
		type: 'post',
		url: aurl + 'member/searchallknows/',
		data: {page:page,mid:mid, src_name:src_name,  src_vocation:src_vocation},
		success: function (data) 
		{
			data = $.parseJSON(data);  
			html =  "<table class='table table-responsive table-bordered'>";
			html += "<tr ><th>Name</th><th>Profession</th><th>Ranking</th><th>Location</th></tr>"  ;  
			$.each(data.results, function (index, item) 
			{
				html += "<tr  >";
				html += "<td>" + item.b + "</td>"; 
				html += "<td>" + item.e + "</td>";
				html += "<td>" + item.f + "</td>";
				html += "<td><input type='button' data-id='"  + item.a + "' class='btn btn-primary btn_connect_invite' value='Invite to Connect' /></td>";
				html +=  " </tr>"; 
			}); 
			html += "</table>";
			 
			$('#allknowsgrid').html(html); 
			 	 
		}
	}); 
} 
 
$(document).on('click', '.btn_connect_invite', function() 
{
	var id = $(this).attr('data-id');   
	 
	$.ajax({
        type: 'post',
        url: aurl + 'member/know/invitetojoin/',
        data: { id: id , mid: mid},
        success: function(data) 
		{
			data = $.parseJSON(data); 
			alertFunc('info',  data.errmsg)			
        } 
	});
});


$(document).on('click', '.linkedinimport_temp', function()
{
    waitFunc('enable');
    $.ajax({
        type: 'post',
        url: aurl + 'linkedin/temporary/import/',
        data: { mid : mid },
        success: function(data) 
		{
			data = $.parseJSON(data);
			alertFunc('success',  data.errmsg);
            waitFunc('');
        }
    });
}) 

$(document).on('click', '.viewimportedliest', function()
{
	gettempimportedlist(1);
}) 


$(document).on('click', '.pagilinkedintemp  li a', function()
{
	var page = $(this).attr('data-pg');
	gettempimportedlist(page);
}) 

$(document).on('click', '.searchimportedliest', function()
{
	
	var name = $('#tbconnectname').val();
	gettempimportedlist(1, name);
})

function gettempimportedlist(page, name='') 
{
     waitFunc('enable');
    $.ajax({
		type: 'post',
		url:  aurl + 'linkedin/show/temporaryimports/',
		data: { goto: page,  userid:mid, name: name },
		success: function(data) 
		{
			waitFunc(''); 
            data = $.parseJSON(data);  
            if(data.error == 10)
            {
				$('#linkedinlist2').html('');
				alertFunc('info', data.errmsg);     
            }
            else if(data.error == 1 )
            {
				$('#linkedinlist2').html('');
				alertFunc('danger', 'Something went wrong, please try again')
            }
            else
            {
				html  = "<table class='table table-colored table-alternate table-bordered'>" + 
				"<tr><th>Name</th><th>Phone</th><th>Email</th><th>Profession</th><th>Invite Sent On</th><th>Action</th></tr>";
				
				$.each(data.result, function(idx, item)
				{
					html  += "<tr><td>" + item.b + '</td><td>' + item.i + '</td><td>' + item.c + '</td><td>' + item.e + '</td>';
					html  += '<td>' + item.j  + '</td>';
					html  += '<td>' + '<button data-email="' + item.c + '"  data-receipent="' + item.b + 
					'"  data-id="'   + item.a   +  '" class="btn btn-primary btn-small btnsendconnect"><i class="fa fa-envelope"></i></button></td></tr>' ; 	
                });
				
				lastpage =  data.pages ;
				prev =  (page == 1) ? 1 :  page-1;
				next = (page == data.pages) ? data.pages : page +1;  
				html  += "<tr><td colspan='6'><ul class='pagination pagilinkedintemp'><li><a  data-func='prev' data-pg='" + prev +"'>«</a></li>";
				if( page  > 10) 	 
                    html  += "<li><a  data-func='next' title='Show last few pages' data-pg='1'> ... </a></li>";
                    
                    if(page < 10)
                    { 
                        for(var j= 1 ;  j  <=  10  ;  j++)
                        {
                            if( j > data.pages)
                            {
								break;
                            }
                            active = (j == page ) ? 'active' : '';
                            html  += "<li class='" + active + "'><a   data-pg='" + j  +"'>" + j  +"</a></li>";
                        }
                    }
                    else
                    {
						for(var i = (page - 5) ;  i<= page + 4;  i++)
						{
							if( i > data.pages)
							{
								break;
							}
							active = ( i == page) ? 'active' : '';
							html  += "<li class='" + active + "'><a   data-pg='" + i  +"'>" + i  +"</a></li>";
                        }
                    } 
					if( page < (lastpage - 10 ) )
						html  += "<li><a  data-func='next' title='Show last few pages'" +  
					"data-pg='" + lastpage  +"'> ... </a></li>";
					
					html  +=  "<li><a   data-func='next' title='Next Page' data-pg='" + next  +"'>»</a></li></ul></td></tr>"; 
                    html  +=  "</table>";
				
				$('#linkedinlist2').html(html); 
			}
        },
        error: function()
		{
			waitFunc('');
			alertFunc('info', 'Something went wrong, please try again')
        }
    });
} 


$(document).on('click', '.btnsendconnect', function() {
	event.preventDefault();
	waitFunc('enable');
    var name = $(this).attr('data-receipent');
	var email = $(this).attr('data-email');
	var id = $(this).attr('data-id');
 
	waitFunc('');
	$.ajax({
		type: 'post',
		url:  aurl + 'member/connect/email/',
		data: { email: email ,name:name, mid: mid,id:id },
		success: function(data)
		{
			data=$.parseJSON(data);
			gettempimportedlist(1) ;
			alertFunc('info',  data.errmsg)
		} 
	});
	
})	


$(document).on('click', '.btn_save_activity', function()
{
	event.preventDefault();
	waitFunc('enable');
	
	var selectedmember = [];
	$('input[name=rad_member]').each(function()
	{
		if(this.checked )
			selectedmember.push( $(this).val() ); 
	}); 
	var desc = $("#activity_desc").val();	  
	$.ajax({
		type: 'post',
		url:  aurl + 'staff/activity/log/',
		data: { staffid: mid , cid :selectedmember.toString(),  actdesc : desc },
		success: function(data)
		{
			data=$.parseJSON(data);  
			waitFunc('');
		} 
	}); 
})	


$(document).on('click', '.loadmylogs', function() 
{
	reloadlogs(1)
})


function reloadlogs(page)
{
	var i=0;
	$.ajax({
		type: 'post',
		url:  aurl + 'staff/activity/getlog/',
		data: {  mid: mid , page: page },
		success: function(data)
		{
			data=$.parseJSON(data);  
			console.log(data);
			html  = "<table class='table table-colored table-alternate table-bordered'>" + 
				"<tr><th>Name</th><th>package</th><th>Sent Date</th><th>Details</th><th>Action</th></tr>";
				
				$.each(data.results, function(idx, item)
				{
					html  += "<tr><td>" + item.d + '</td><td>' + item.e + '</td><td>' + item.b + '</td><td>' + item.c + '</td>';
					  
					html  += '<td>' + '<button data-name="' + item.d + '"  data-id="' + item.a +  
					'" class="btn btn-primary btn-small vu_detaillog"><i class="fa fa-file"></i></button></td></tr>' ;
					i++;					
                }); 
			if(i > 0)	 
				$('#activity_log').html(html);
			else
				$('#activity_log').html('<div class="alertinfofix text-center">You have not created any task log!</div>');
		} 
	});  
}


$(document).on('click', '.vu_detaillog', function()
{
	var id = $(this).attr("data-id");
	 
	 
})	